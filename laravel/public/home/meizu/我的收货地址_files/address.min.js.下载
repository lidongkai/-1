!function(e){function t(s){if(r[s])return r[s].exports;var a=r[s]={exports:{},id:s,loaded:!1};return e[s].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){function s(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),r=window.location.search.substr(1).match(t);return null!==r?unescape(r[2]):null}function a(e){var t=/[a-z]+:\/\/[a-z0-9_\-\/.%]+/i;return t.test(e)?e:!1}r(2),r(3),function(e){var t=e("#J_newAddress"),r=e(".J_addressModify"),i=e(".J_addressDel"),d=s("redirectUrl")||"",o=s("autoShow")?!0:!1;d=a(d),t.on("click",function(e){e.preventDefault(),MI.checkUserRisk.init({action:"addr_add",callback:function(){MI.addressEdit.editAddress({action:"new",callback:function(){d?location.href=d:location.reload()}})}})}),r.on("click",function(t){var r=e(this),s=r.closest(".address-item");t.preventDefault(),MI.checkUserRisk.init({action:"addr_add",callback:function(){MI.addressEdit.editAddress({action:"edit",addressId:s.attr("data-address_id"),addressData:{address_id:s.attr("data-address_id"),consignee:s.attr("data-consignee"),tel:s.attr("data-tel"),province_id:s.attr("data-province_id"),province_name:s.attr("data-province_name"),city_id:s.attr("data-city_id"),city_name:s.attr("data-city_name"),district_id:s.attr("data-district_id"),district_name:s.attr("data-district_name"),area:s.attr("data-area")?s.attr("data-area"):"",area_name:s.attr("data-area_name")?s.attr("data-area_name"):"",zipcode:s.attr("data-zipcode")?s.attr("data-zipcode"):"",address:s.attr("data-address"),tag_name:s.attr("data-tag_name")?s.attr("data-tag_name"):""},callback:function(){location.reload()}})}})}),i.on("click",function(t){var r=e(this),s=r.closest(".address-item");t.preventDefault(),r.hasClass("disabled")||MI.checkUserRisk.init({action:"addr_delete",callback:function(){if(window.confirm("确定删除该地址吗？")){r.addClass("disabled");var t=e.cookie("xm_order_btauth")||null,a=e.cookie("miUserRiskToken")||"";e.ajax({type:"POST",url:MI.GLOBAL_CONFIG.orderSite+"/address/delete.php?bts="+t,data:{id:r.attr("data-id"),risk_token:a},dataType:"json",success:function(e){r.removeClass("disable"),1!==e.code?alert(e.msg):s.fadeOut(500)}})}}})}),MI.addressEdit.init(),o&&t.trigger("click")}(jQuery)},function(e,t){MI.checkUserRisk=function(){function e(){return multiline(function(){/*!@tpl
	<div  class="modal modal-hide fade modal-user-risk" id="J_modalUserRisk">
	    <div class="modal-hd">
	        <h3 class="title">验证信息</h3>
	        <a class="close" data-dismiss="modal" href="javascript: void(0);"><i class="iconfont">&#xe602;</i></a>
	    </div>
	    <div class="modal-bd">
	        <h3 class="title">您的账号存在风险</h3>
	        <p class="desc">如需继续操作，我们将向您绑定的手机 <span id="J_userRiskPhone"></span> 发送验证码</p>

	        <div class="form-section">
	            <label class="input-label" for="J_riskCode">输入验证码</label>
	            <input class="input-text input-url" type="text" id="J_riskCode" name="J_riskCode" />
	            <a href="javascript:void(0);" class="btn btn-get" id="J_getRiskCode">获取验证码 &gt;</a>
	            <span href="javascript:void(0);" class="btn btn-coutdown hide" id="J_riskCoutdown"></span>
	        </div>
	        <div class="tip-msg" id="J_riskTipMsg"></div>
	    </div>
	    <div class="modal-ft">
	        <a class="btn btn-gray" data-dismiss="modal" href="javascript: void(0);">取消</a>
	        <a class="btn btn-primary" href="javascript: void(0);" id="J_submitRiskCode">提交</a>
	    </div>
	</div>
	  */
console.log()})}function t(){return multiline(function(){/*!@tpl
	<div  class="modal modal-hide fade modal-user-risk" id="J_modalUserRisk">
	    <div class="modal-hd">
	        <h3 class="title">验证信息</h3>
	        <a class="close" data-dismiss="modal" href="javascript: void(0);"><i class="iconfont">&#xe602;</i></a>
	    </div>
	    <div class="modal-bd">
	        <h3 class="title">您的账号存在风险</h3>
	        <p class="desc">如需继续操作，请前往账号中心完成安全设置</p>
	        <a href="https://account.xiaomi.com/pass/auth/security/home" class="btn btn-primary "
	        id="J_riskPortalLink" target="_blank">前往小米账号中心</a>
	    </div>
	</div>
	  */
console.log()})}function r(){var r=MI.GLOBAL_CONFIG.orderSite+"/risk/checkuser",a=$.cookie("miUserRiskToken")||"";$.ajax({type:"POST",url:r,dataType:"json",data:{risk_token:a},timeout:5e3,error:function(){alert("抱歉！网络超时，请刷新重试！")},success:function(r){-1===r.code?(n(),r.data&&r.data.safe_mobile?($("body").append(e()),$("#J_userRiskPhone").html(r.data.safe_mobile)):$("body").append(t()),s()):1===r.code&&"function"==typeof u.callback?u.callback():alert(r.msg)}})}function s(){var e=$("#J_modalUserRisk");MI.form.init(),e.modal({show:!0,backdrop:"static"}),$("#J_submitRiskCode").on("click",function(){return d(),!1}),$("#J_getRiskCode").on("click",function(){return a(),!1})}function a(){var e=MI.GLOBAL_CONFIG.orderSite+"/risk/sendsms";$.ajax({type:"POST",url:e,dataType:"json",data:{sms_action:u.action},success:function(e){1===e.code?i():o(e.msg)}})}function i(){var e,t=60,r=$("#J_riskCoutdown"),s=function(){return r.html(t+"秒后重新获取"),t-=1,e&&clearTimeout(e),0>=t?(r.addClass("hide").siblings(".btn").removeClass("hide"),!1):void(e=setTimeout(s,1e3))};o(),r.removeClass("hide").siblings(".btn").addClass("hide"),s()}function d(){var e=$.trim($("#J_riskCode").val()),t=MI.GLOBAL_CONFIG.orderSite+"/risk/checksmscode";return e?void $.ajax({type:"POST",url:t,dataType:"json",data:{sms_code:e},timeout:5e3,error:function(){o("抱歉！网络超时，请重试!")},success:function(e){1===e.code&&"function"==typeof u.callback?($("#J_modalUserRisk").modal("hide"),$.cookie("miUserRiskToken",e.data.risk_token,{expires:1,path:"/",domain:"mi.com"}),u.callback()):o(e.msg)}}):void o("请输入正确的验证码!")}function o(e){$("#J_riskTipMsg").html(e?e:"")}function n(){$("#J_modalUserRisk").remove(),$.cookie("miUserRiskToken",null)}function c(e){u=$.extend(l,e||{}),r()}var l={action:"",callback:$.noop},u={};return{init:c}}()},function(e,t,r){r(4),MI.namespace("searchAddress"),MI.searchAddress={init:function(e){var t=this,r={searchCallback:$.noop};t.options=$.extend(r,e),t.apiUrl={search:MI.GLOBAL_CONFIG.orderSite+"/address/searchByKeywords",translate:MI.GLOBAL_CONFIG.orderSite+"/address/getAreaInfoByLocation",login:MI.GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl="+location.href},t.$input=$("#J_searchAddressInput"),t.$inputClear=$("#J_searchAddressInputClear"),t.$searchWrapper=$("#J_searchAddressWrapper"),t.$loading=t.$searchWrapper.find(".loading"),t.$nearbyAddr=t.$searchWrapper.find("#J_nearbyAddress"),t.$nearbyAddrList=t.$nearbyAddr.find(".list"),t.$searchAddr=t.$searchWrapper.find("#J_searchAdress"),t.$searchAddrList=t.$searchAddr.find(".list"),t.$noResult=t.$searchWrapper.find("#J_noSearchResult"),t.searchVal=null,t.nearbyData=null,t.checkLogin(),t.searchEvent(),t.selectEvent()},checkLogin:function(){this.isLogin=$.cookie("userId")&&$.cookie("xm_order_btauth")?!0:!1},revert:function(){this.$input.val(""),this.searchVal=null,this.toggleShow(this.$nearbyAddr,!1),this.toggleShow(this.$searchAddr,!1),this.toggleShow(this.$noResult,!1)},searchEvent:function(){var e,t,r=this,s=200;r.$input.on({focus:function(){r.toggleShow(r.$loading,!0),r.searchVal?r.searchAddress():r.nearbyData?r.formatAddress(r.nearbyData,null,"nearby"):r.searchAddress()},blur:function(){t&&clearTimeout(t),t=setTimeout(function(){r.toggleShow(r.$loading,!1),r.toggleShow(r.$nearbyAddr,!1),r.toggleShow(r.$searchAddr,!1),r.toggleShow(r.$noResult,!1),$(".J_switchType").eq(0).show()},200)},keyup:function(){e&&clearTimeout(e),e=setTimeout(function(){r.searchVal=$.trim(r.$input.val().replace(/[\-_'=+|\\\/]/g," ")),r.searchVal?r.toggleShow(r.$inputClear,!0):r.toggleShow(r.$inputClear,!1),r.toggleShow(r.$nearbyAddr,!1),r.toggleShow(r.$searchAddr,!1),r.toggleShow(r.$noResult,!1),r.toggleShow(r.$loading,!0),r.searchAddress()},s)}}),r.$inputClear.on("click",function(){r.searchVal=null,r.$input.val("").focus(),r.toggleShow(r.$inputClear,!1)})},selectEvent:function(){var e=this;$.each([e.$nearbyAddrList,e.$searchAddrList],function(t,r){r.on("click",".J_searchAddressItem",function(){var t=$(this).attr("data-code"),r=$(this).attr("data-location");e.translateSearchResult({code:t,location:r})})})},toggleShow:function(e,t){t?e.removeClass("hide"):e.addClass("hide")},searchAddress:function(){var e=this,t=e.searchVal?"search":"nearby";$.ajax({url:e.apiUrl.search,dataType:"jsonp",jsonp:"jsonpcallback",data:{keywords:e.searchVal},timeout:3e4,cache:!0,error:function(){},success:function(r){if(r&&1===r.code){if($(".J_switchType").eq(0).show(),!r.data||!r.data.length)return e.toggleShow(e.$loading,!1),void("search"===t&&(e.toggleShow(e.$noResult,!0),$(".J_switchType").eq(0).hide()));e.searchVal||(e.nearbyData=r.data),e.formatAddress(r.data.slice(0,5),null,t)}}})},formatAddress:function(e,t,r){if(e){var s=this,a=multiline(function(){/*!@tpl
	        {{~it :value:index}}
	            <li class="J_searchAddressItem" data-code="{{=value.adcode ? value.adcode : ''}}"
	            data-location="{{=value.location}}">
	                <div class="address-title">
	                    <span class="item">{{=value.name}}</span>
	                </div>
	                <div class="address-desc">
	                    {{=value.pname}}{{=value.cityname}}{{=value.adname}}
	                </div>
	                <a class="btn btn-primary">选择</a>
	            </li>
	        {{~}}
	        */
console.log()}),i="";s.toggleShow(s.$loading,!1),s.toggleShow(s.$noResult,!1),"nearby"===r?(i=doT.template(a)(e),s.$nearbyAddrList.html(i),s.toggleShow(s.$nearbyAddr,!0)):"search"===r&&(i=doT.template(a)(e),s.$searchAddrList.html(i),s.toggleShow(s.$searchAddr,!0)),"function"==typeof t&&$.proxy(t,s)()}},translateSearchResult:function(e){var t=this;$.ajax({url:t.apiUrl.translate,dataType:"jsonp",jsonp:"jsonpcallback",data:{adcode:e.code,location:e.location},timeout:3e4,error:function(){},success:function(e){e&&1===e.code&&t.formatChooseResult(e.data)}})},formatChooseResult:function(e){var t=this,r=[];$.each(e,function(e,t){r.push({id:t.id,name:t.name,zcode:t.zipcode?t.zipcode:""})}),r.length&&"function"==typeof t.options.searchCallback&&t.options.searchCallback(r)}},MI.namespace("addressEdit"),MI.addressEdit={init:function(){var e=this;this.userAddress={},this.editOptions={action:"new",hastv:!1,addressId:0,addressData:{},callback:$.noop},this.buildDom(),MI.form.init(),this.formElem={$modal:$("#J_modalEditAddress"),$name:$("#J_addressNameInput"),$phone:$("#J_addressPhoneInput"),$addressDetail:$("#J_addressDetailInput"),$zipcode:$("#J_addressZipcodeInput"),$tag:$("#J_addressTagInput"),$tip:$("#J_formTipMsg"),$fourAddress:$("#J_selectAddressTrigger"),$selectAddress:$("#J_selectAddressWrapper")},this.riskToken=$.cookie("miUserRiskToken")||"",MI.searchAddress.init({searchCallback:function(t){e.formElem.$selectAddress.addClass("hide"),e.saveSelectAddress(t)}}),this.fourAddress=new MI.fourAddress,this.fourAddress.init({wrapperElm:"#J_fourAddressWrapper",selectEnd:function(t){e.formElem.$selectAddress.addClass("hide"),e.saveSelectAddress(t)}}),this.switchType(),this.switchSelectAddress(),$("#J_editAddressSave").on("click",function(){var t=!1;$(".J_addressInput").each(function(){return t=e.validation($(this)),t?void 0:!1}),t&&e.saveAddress()}),$(".J_addressInput").on("blur",function(){var t=$.trim($(this).val()),r="four_address"===$(this).attr("name")?!0:!1;t&&!r&&e.validation($(this))})},buildDom:function(){var e=multiline(function(){/*!@tpl
	        <div class="modal modal-hide fade modal-edit-address" id="J_modalEditAddress">
	            <div class="modal-header">
	                <span class="title">添加收货地址</span>
	                <a class="close" data-dismiss="modal" href="javascript: void(0);"><i class="iconfont">&#xe602;</i></a>
	            </div>
	            <div class="modal-body">
	                <div class="form-box clearfix">
	                    <div class="form-section form-name">
	                        <label class="input-label" for="user_name">姓名</label>
	                        <input class="input-text J_addressInput" type="text"
	                        id="J_addressNameInput" name="user_name" placeholder="收货人姓名" />
	                    </div>
	                    <div class="form-section form-phone">
	                        <label class="input-label" for="user_phone">手机号</label>
	                        <input class="input-text J_addressInput" type="text"
	                        id="J_addressPhoneInput" name="user_phone"  placeholder="11位手机号" />
	                    </div>
	                    <div class="form-section form-four-address">
	                        <input id="J_selectAddressTrigger" class="input-text J_addressInput"
	                        type="text"  name="four_address" readonly="readonly"
	                        value="选择省 / 市 / 区 / 街道" placeholder="选择省 / 市 / 区 / 街道" />
	                        <i class="iconfont">&#xe61c;</i>
	                    </div>
	                    <div class="form-section form-address-detail">
	                        <label class="input-label" for="user_adress">详细地址</label>
	                        <textarea class="input-text J_addressInput" type="text"
	                        id="J_addressDetailInput" name="user_adress" placeholder="详细地址，路名或街道名称，门牌号"></textarea>
	                    </div>
	                    <div class="form-section form-zipcode">
	                        <label class="input-label" for="user_zipcode">邮政编码</label>
	                        <input class="input-text J_addressInput" type="text" id="J_addressZipcodeInput"
	                        name="user_zipcode" />
	                    </div>
	                    <div class="form-section form-tag">
	                        <label class="input-label" for="user_tag">地址标签</label>
	                        <input class="input-text J_addressInput" type="text" id="J_addressTagInput"
	                        name="user_tag"  placeholder="如&quot;家&quot;、&quot;公司&quot;。限5个字内" />
	                    </div>

	                    <div class="form-section form-tip-msg clearfix" id="J_formTipMsg"></div>
	                </div>

	                <div class="select-address-wrapper hide"  id="J_selectAddressWrapper">
	                    <span class="select-address-close">x</span>
	                    <div class="search-address-wrapper J_selectAddressItem" data-type="search"
	                    id="J_searchAddressWrapper">
	                        <div class="search-section">
	                            <i class="icon icon-search iconfont">&#xe616;</i>
	                            <input class="search-input" id="J_searchAddressInput" type="text"
	                            placeholder="输入街道、乡镇、小区或商圈名称" autocomplete="off">
	                            <span class="icon icon-del iconfont hide" id="J_searchAddressInputClear">&#xd7;</span>
	                        </div>

	                        <div class="search-example">例如：北京 华润五彩城</div>

	                        <div class="loading hide"><div class="loader"></div></div>

	                        <!-- 附近商圈 -->
	                        <div class="nearby-address hide" id="J_nearbyAddress">
	                            <div class="title">附近商圈</div>
	                            <ul class="list clearfix"></ul>
	                        </div>

	                        <!-- 搜索列表 -->
	                        <div class="search-address hide" id="J_searchAdress">
	                            <ul class="list clearfix"></ul>
	                        </div>

	                        <div class="no-result hide" id="J_noSearchResult">
	                            没有找到这个地方，<a href="javascript:void(0);"   class="J_switchTypeTrigger"
	                            data-type="select">手动选择&gt;</a>
	                        </div>
	                        <div class="switch-type J_switchType">
	                            <a href="javascript:void(0);"   class="J_switchTypeTrigger"
	                            data-type="select">手动选择地址&gt;</a>
	                        </div>
	                    </div>
	                    <div class="four-address-wrapper hide J_selectAddressItem" data-type="select" >
	                        <div id="J_fourAddressWrapper"></div>
	                        <div class="switch-type">
	                            <a href="javascript:void(0);"   class="J_switchTypeTrigger"
	                            data-type="search"> 搜索地址快速定位&gt;</a>
	                        </div>
	                    </div>
	                </div>
	            </div>
	            <div class="modal-footer">
	                <a href="javascript:void(0);" class="btn btn-primary" id="J_editAddressSave">保存</a>
	                <a href="#J_modalEditAddress" class="btn btn-gray" data-toggle="modal">取消</a>
	            </div>
	        </div>
	        */
console.log()});$("body").append(e)},editAddress:function(e){var t=this;t.editOptions=$.extend(t.editOptions,e),"new"===t.editOptions.action?t.showModal():"edit"===t.editOptions.action&&(t.setFormAddress(),t.showModal()),"true"===t.editOptions.hastv&&t.formElem.$name.attr("placeholder","收货时将核对身份证信息").siblings("label").html("真实姓名")},showModal:function(){var e=this;e.formElem.$modal.modal({show:!0,backdrop:"static"}).one("hidden",function(){e.revertForm()})},saveSelectAddress:function(e){var t=this,r="";t.userAddress.province=e[0].id,t.userAddress.provinceName=e[0].name,t.userAddress.city=e[1].id,t.userAddress.cityName=e[1].name,t.userAddress.county=e[2].id,t.userAddress.countyName=e[2].name,t.userAddress.zipcode=e[2].zcode,t.userAddress.area=e[3].id,t.userAddress.areaName=e[3].name,$.each(e,function(e,t){r+=" "+t.name}),t.formElem.$fourAddress.val(r).addClass("active"),t.formElem.$zipcode.val(e[2].zcode).trigger("focus").trigger("blur")},setFormAddress:function(){var e=this,t=e.editOptions.addressData;e.userAddress.province=t.province_id,e.userAddress.provinceName=t.province_name,e.userAddress.city=t.city_id,e.userAddress.cityName=t.city_name,e.userAddress.county=t.district_id,e.userAddress.countyName=t.district_name,e.userAddress.zipcode=t.zipcode,e.userAddress.area=t.area,e.userAddress.areaName=t.area_name,e.userAddress.phone=t.tel,setTimeout(function(){e.formElem.$phone.attr("placeholder",t.tel),e.formElem.$addressDetail.val(t.address).trigger("focus"),e.formElem.$zipcode.val(t.zipcode).trigger("focus"),t.tag_name&&e.formElem.$tag.val(t.tag_name).trigger("focus"),e.formElem.$fourAddress.val(t.province_name+" "+t.city_name+" "+t.district_name+" "+t.area_name).addClass("active"),e.formElem.$name.val(t.consignee).trigger("focus")},200)},validation:function(e){if(e.length){var t,r=this,s=e.attr("name"),a=$.trim(e.val());if("user_name"===s){if(t=/^[a-zA-Z\u4e00-\u9fa5·]+$/,a.length<2||a.length>20)return e.trigger("error",["收货人姓名，最少2个最多20个中文字"]),!1;if(!t.test(a))return e.trigger("error",["收货人姓名不正确（只能是英文、汉字）"]),!1;e.trigger("valid"),r.userAddress.uname=a}else if("user_phone"===s){if(t=/^1[0-9]{10}$/,!t.test(a)&&"edit"!==r.editOptions.action)return e.trigger("error",["请输入正确的手机号"]),!1;if("edit"===r.editOptions.action&&""!==a&&!t.test(a))return e.trigger("error",["请输入正确的手机号"]),!1;e.trigger("valid"),r.userAddress.phone=a}else if("four_address"===s){if(!(r.userAddress.province&&r.userAddress.city&&r.userAddress.county&&r.userAddress.area))return e.trigger("error",["请选择地址"]),!1}else if("user_adress"===s){a=a.replace(/</g,"").replace(/>/g,"").replace(/\//g,"").replace(/\\/g,""),t=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;var i=/^\d+$/,d=/^[0-9a-zA-Z]+$/;if(a.length<5||a.length>32)return e.trigger("error",["详细地址长度不对，最小为 5 个字，最大32个字"]),!1;if(t.test(a)||i.test(a)||d.test(a))return e.trigger("error",["详细地址不正确"]),!1;e.trigger("valid"),r.userAddress.address=a}else if("user_zipcode"===s){if(t=/^\d{6}$/,!t.test(a))return e.trigger("error",["邮编是6位数字"]),!1;e.trigger("valid"),r.userAddress.zipcode=a}else if("user_tag"===s){if(a.length>5)return e.trigger("error",["地址标签最长5个字"]),!1;e.trigger("valid"),r.userAddress.tag=a}return!0}},saveAddress:function(){var e=this,t={consignee:e.userAddress.uname,province_id:e.userAddress.province,city_id:e.userAddress.city,district_id:e.userAddress.county,area:e.userAddress.area,address:e.userAddress.address,zipcode:e.userAddress.zipcode,tel:e.userAddress.phone,tag_name:e.userAddress.tag},r=$.cookie("xm_order_btauth")?$.cookie("xm_order_btauth"):"",s=MI.GLOBAL_CONFIG.orderSite+"/address/add.php?bts="+r;"edit"===e.editOptions.action&&(t.address_id=e.editOptions.addressId,s+="&id="+e.editOptions.addressId+"&action=edit"),e.formElem.$tip.html(""),$.ajax({type:"POST",url:s,dataType:"json",data:{newAddress:t,risk_token:e.riskToken},timeout:1e4,error:function(){},success:function(t){console.log(t),t&&1===t.code?(e.formElem.$modal.modal("hide"),e.userAddress.address_id=t.data.address_id,"function"==typeof e.editOptions.callback&&("edit"===e.editOptions.action&&(e.userAddress.phone=e.editOptions.addressData.tel),e.editOptions.callback(e.editOptions.action,e.userAddress))):e.formElem.$tip.html(t.msg)}})},switchType:function(){$(".J_switchTypeTrigger").on("click",function(){var e=$(this).attr("data-type");e&&$(".J_selectAddressItem[data-type="+e+"]").removeClass("hide").siblings(".J_selectAddressItem").addClass("hide")})},switchSelectAddress:function(){var e=this;e.formElem.$fourAddress.on("click",function(){e.formElem.$selectAddress.removeClass("hide").find(".select-address-close").one("click",function(){e.formElem.$selectAddress.addClass("hide")})})},revertForm:function(){var e=this;e.formElem.$name.val("").trigger("valid"),e.formElem.$phone.attr("placeholder","手机号").val("").trigger("valid"),e.formElem.$fourAddress.val(e.formElem.$fourAddress.attr("placeholder")).trigger("valid"),e.formElem.$addressDetail.val("").trigger("valid"),e.formElem.$zipcode.val("").trigger("valid"),e.formElem.$tag.val("").trigger("valid"),e.formElem.$tip.html("").trigger("valid"),e.formElem.$selectAddress.addClass("hide"),$('.J_switchTypeTrigger[data-type="search"]').trigger("click"),this.fourAddress.init()}}},function(e,t){MI.namespace("fourAddress"),MI.fourAddress=function(){this.options={wrapperElm:"#J_selectAddressWrapper",optionsWrapper:".J_optionsWrapper",selectWrapper:"#J_selectWrapper",maxLevel:4,afterFormat:$.noop,selectEnd:$.noop}},MI.fourAddress.prototype={constructor:MI.fourAddress,init:function(e){var t=this;"object"==typeof e&&(t.options=$.extend(t.options,e)),t.$wrapper=$(t.options.wrapperElm),t.$wrapper.length&&(t.addrUrl="//s1.mi.com/open/common/js/address_all_new.js?v=7930814",t.addressData=[],t.addrTemp=multiline(function(){/*!@tpl
	          <div class="select-box clearfix" id="J_selectWrapper">
	              <div class="select-first select-item J_select" data-init-txt="选择省份/自治区">选择省份/自治区</div>
	              <div class="select-item J_select hide" data-init-txt="选择城市/地区"></div>
	              <div class="select-item J_select hide" data-init-txt="选择区县"></div>
	              <div class="select-last select-item J_select hide" data-init-txt="选择配送区域"></div>
	          </div>

	          <div class="options-box">
	              <ul class="options-list J_optionsWrapper clearfix">
	                  {{~it :value:index}}
	                      <li class="option J_option"
	                      data-value="{{=value.id}}"
	                      data-txt="{{=value.name}}">{{=value.name}}
	                      </li>
	                  {{~}}
	              </ul>
	              <ul class="options-list J_optionsWrapper clearfix hide"></ul>
	              <ul class="options-list J_optionsWrapper clearfix hide"></ul>
	              <ul class="options-list J_optionsWrapper clearfix hide"></ul>
	          </div>
	        */
console.log()}),t.optionTemp=multiline(function(){/*!@tpl
	          {{~it :value:index}}
	            {{? value.region_id}}
	            <li class="J_option" data-txt="{{=value.region_name}}" data-value="{{=value.region_id}}">
	            {{=value.region_name}}</li>
	            {{?? }}
	            <li class="J_option" data-txt="{{=value.name}}" data-value="{{=value.id}}"
	            data-zipcode="{{=value.zipcode ? value.zipcode : ''}}">{{=value.name}}</li>
	            {{? }}
	          {{~}}
	        */
console.log()}),t.result={},t.lastLevel=t.options.maxLevel-1,t.getAllRegions())},getAllRegions:function(){var e=this;$.ajax({url:e.addrUrl,dataType:"script",cache:!0,timeout:3e4,error:function(){},success:function(){"undefined"!=typeof window.data&&(e.addressData=window.data),e.formatRegions()}})},formatRegions:function(){var e=this,t=doT.template(e.addrTemp),r=t(e.addressData);e.$wrapper.html(r),e.$optionsWrapper=e.$wrapper.find(e.options.optionsWrapper),e.$selectWrapper=e.$wrapper.find(e.options.selectWrapper),e.selectEvent(),"function"==typeof e.options.afterFormat&&e.options.afterFormat()},selectEvent:function(){var e=this,t=0;e.$selectWrapper.on("click.seladdr",".J_select",function(){var r=$(this).addClass("active"),s=$(this).attr("data-init-txt");r&&(t=$(this).index(),e.$selectWrapper.find(".J_select:gt("+t+")").addClass("hide").removeClass("active"),e.$optionsWrapper.addClass("hide").eq(t).removeClass("hide"),$(this).html(s).removeClass("active"))}),e.$optionsWrapper.on("click.seladdr",".J_option",function(){var r=parseInt($(this).attr("data-value")),s=$(this).attr("data-txt"),a=$(this).attr("data-zipcode")||"",i=t+1,d=e.$selectWrapper.find(".J_select").eq(i);return e.result[t]={id:r,name:s,zcode:a},e.$selectWrapper.find(".J_select").eq(t).html(s).addClass("active"),t===e.lastLevel?void("function"==typeof e.options.selectEnd&&e.options.selectEnd(e.result)):(t+=1,i>=e.lastLevel?e.getLastLevelData():e.formatNextLevelOption(r,i),void(d.length&&d.html(d.attr("data-init-txt")).removeClass("hide")))})},getAddressLevelData:function(e){var t=[],r=this;return $.each(r.addressData,function(r,s){return s.id===e?(t=s.child,!1):void(s.child&&$.each(s.child,function(r,s){return s.id===e?(t=s.child,!1):void(s.child&&$.each(s.child,function(r,s){return s.id===e?(t=s.tags,!1):void 0}))}))}),t},formatNextLevelOption:function(e,t){if(e){var r=this,s=r.getAddressLevelData(e,t),a=r.formatOption(s);r.$optionsWrapper.addClass("hide").eq(t).html(a).removeClass("hide"),1===s.length&&setTimeout(function(){r.$optionsWrapper.eq(t).find(".J_option").eq(0).trigger("click")},50)}},getLastLevelData:function(){var e=this,t=MI.GLOBAL_CONFIG.orderSite+"/api/getAddressRegion.php";e.$optionsWrapper.addClass("hide").eq(e.lastLevel).html('<div class="loading"><div class="loader"></div></div>').removeClass("hide"),$.ajax({url:t,dataType:"jsonp",jsonp:"jsonpcallback",data:{parent:e.result[2].id},tiemout:3e4,error:function(){},success:function(t){if(t&&t.data.regions){var r=[];$.each(t.data.regions,function(e,t){r.push(t)});var s=e.formatOption(r);e.$optionsWrapper.eq(e.lastLevel).html(s)}}})},formatOption:function(e){var t=this,r="";return e?r=doT.template(t.optionTemp)(e):void 0},getResult:function(){return this.result}}}]);